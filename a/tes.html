<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <title></title>
  <style>
  #campo {
  position: absolute;
  top:10px;
  left:150px;
  background-color: Aquamarine;
  height:600px;
  width:600px;
}

#snake_testa {
  position: absolute;
  top:30px;
  left:30px;
  height:30px;
  width:30px;
  border-radius: 15px;
  background-color:green;
}

#od {
  position: absolute;
  top:4px;
  left:4px;
  height:4px;
  width:4px;
  background-color:black;
}

#os {
  position: absolute;
  top:4px;
  left:18px;
  height:4px;
  width:4px;
  background-color:black;
}

#score {
  position: absolute;
  top: 80px;
  background-color:white;
}

#restart {
  position: absolute;
  top: 10px;
  left:10px;
  height:25px;
  width:120px;
  background-color:white;
}

#pausa {
  position: absolute;
  top: 45px;
  left:10px;
  height:25px;
  width:120px;
  background-color:white;
}
  </style>
</head>
<body>
<div id="campo">
<div id="snake_testa"> <div id=od></div> <div id=os></div> </div>
<div id="snake0"></div>
</div>0
<div id="score"></div>
<button id="restart">restart</button>
<button id="pausa">pausa</button>
<script>
function choice(a) {
  return a[Math.floor(Math.random() * a.length)];
}

var img_cibi = ["http://icon-icons.com/icons2/990/PNG/256/hamburger-icon-256_icon-icons.com_75220.png", "http://icon-icons.com/icons2/990/PNG/256/banana-icon-256_icon-icons.com_75209.png", "http://icon-icons.com/icons2/990/PNG/256/pop-corn-icon-256_icon-icons.com_75225.png", "http://icon-icons.com/icons2/468/PNG/512/Cheese_44338.png", "http://icon-icons.com/icons2/468/PNG/512/Apple_44337.png", "http://icon-icons.com/icons2/468/PNG/512/Bread_44349.png", "http://icon-icons.com/icons2/568/PNG/512/eggs_icon-icons.com_54431.png", "http://icon-icons.com/icons2/567/PNG/512/hotdog_icon-icons.com_54393.png"];
var foody = 0;
var dim = 30;
var xtesta = 1;
var ytesta = 1;
var xcorpo = [];
var ycorpo = [];
var xbomba = [];
var ybomba = [];
var xcibo = Math.floor(Math.random() * Math.floor(600 / dim));
var ycibo = Math.floor(Math.random() * Math.floor(600 / dim));
var vx = 1;
var vy = 0;
var score = 0;
var lose = 0;
var pausa = 0;
var hgp = 0;
var vel = 150
var cvel = 0

$("#pausa").click(function(e) {
  pausa = !pausa;
  if (pausa) {
    $("#pausa").text("riprendi");
  }
  if (!pausa) {
    $("#pausa").text("pausa");
  }
});

$("#restart").click(function(e) {
  xcorpo.forEach(function(item, index) {
    $("#snake" + (index + 1)).remove();
  });
  xbomba.forEach(function(item, index) {
    $("#bomb" + (index)).remove();
  });
  dim = 30;
  xtesta = 1;
  ytesta = 1;
  xcorpo = [];
  ycorpo = [];
  xbomba = [];
  ybomba = [];
  xcibo = Math.floor(Math.random() * Math.floor(600 / dim));
  ycibo = Math.floor(Math.random() * Math.floor(600 / dim));
  vx = 1;
  vy = 0;
  score = 0;
  lose = 0;
  pausa = 0;
  $("#snake_testa").css({
    top: "30px",
    left: "30px",
    backgroundColor: "green",
    borderRadius: Math.floor(dim/2)
  });
  $("#od").css({
    backgroundColor: "black"
  });
  $("#os").css({
    backgroundColor: "black"
  });
  disegna();
});

function food() {
  foody = $("<img>");
  foody.attr('id', "bomb" + ((score - 1) / 7));
  foody.attr('src', choice(img_cibi));
  foody.css({
    height: dim,
    width: dim,
    position: "absolute",
    top: ycibo * dim,
    left: xcibo * dim
  });
  foody.appendTo('#campo');
}
food();

function passo() {
  
  xcorpo.unshift(xtesta);
  xcorpo.pop();
  ycorpo.unshift(ytesta);
  ycorpo.pop();

  xtesta += vx;
  ytesta += vy;
  
  if (xtesta > (600 / dim) - 1) {
    xtesta = 0;
  }
  if (xtesta < 0) {
    xtesta = Math.floor(600 / dim) - 1;
  }
  if (ytesta > (600 / dim) - 1) {
    ytesta = 0;
  }
  if (ytesta < 0) {
    ytesta = Math.floor(600 / dim) - 1;
  }

  xbomba.forEach(function(item, index) {
    if (xtesta == xbomba[index] && ytesta == ybomba[index]) {
      lose = 1;
      xbomba.forEach(function(item, index) {
        $("#bomb" + (index)).remove();
      });
      $("#snake_testa").css({
        backgroundColor: "yellow",
        borderRadius: Math.floor(dim / 2)
      });
      $("#od").css({
        backgroundColor: "yellow"
      });
      $("#os").css({
        backgroundColor: "yellow"
      });
    }
  });

  xcorpo.forEach(function(item, index) {
    if (xtesta == xcorpo[index] && ytesta == ycorpo[index]) {
      lose = 1;
      $("#snake" + (index + 1)).css({
        backgroundColor: "yellow",
      });
      xbomba.forEach(function(item, index) {
        $("#bomb" + (index)).remove();
      });

    }
  });
}

function mangia() {
  if (xtesta == xcibo && ytesta == ycibo) {
    score += 1;
    xcibo = Math.floor(Math.random() * Math.floor(600 / dim));
    ycibo = Math.floor(Math.random() * Math.floor(600 / dim));
    foody.attr('src', choice(img_cibi));
    pezzo = $('<div></div>');
    pezzo.attr('id', ("snake" + score));
    pezzo.css({
      height: dim,
      width: dim,
      position: "absolute",
      borderRadius: Math.floor(dim / 2),
      backgroundColor: "green",
    });
    pezzo.appendTo('#campo');
    xcorpo.push(xcorpo[xcorpo.length - 1]);
    ycorpo.push(ycorpo[ycorpo.length - 1]);

    if (score % 7 == 1) {
      xbomba.push(Math.floor(Math.random() * Math.floor(600 / dim)));
      ybomba.push(Math.floor(Math.random() * Math.floor(600 / dim)));
      img = $("<img>");
      img.attr('id', "bomb" + ((score - 1) / 7));
      img.attr('src', "http://pngimg.com/upload_small/bomb/bomb_PNG9.png");
      img.css({
        height: dim,
        width: dim,
        position: "absolute",
        top: ybomba[(score - 1) / 7] * dim,
        left: xbomba[(score - 1) / 7] * dim
      });
      img.appendTo('#campo');

    }
  }
}

function disegna() {
  $("#snake_testa").css({
    top: ytesta * dim,
    left: xtesta * dim
  });

  if (vx == 1) {
    $("#od").css({
      top: "19px",
      left: "19px",
    });
    $("#os").css({
      top: "7px",
      left: "19px",
    });
  }

  if (vx == -1) {
    $("#od").css({
      top: "7px",
      left: "7px",
    });
    $("#os").css({
      top: "19px",
      left: "7px",
    });
  }

  if (vy == 1) {
    $("#od").css({
      top: "19px",
      left: "7px",
    });
    $("#os").css({
      top: "19px",
      left: "19px",
    });
  }

  if (vy == -1) {
    $("#od").css({
      top: "7px",
      left: "19px",
    });
    $("#os").css({
      top: "7px",
      left: "7px",
    });
  }

  xcorpo.forEach(function(item, index) {
    $("#snake" + (index + 1)).css({
      top: ycorpo[index] * dim,
      left: xcorpo[index] * dim
    });
  });

  foody.css({
    height: dim,
    width: dim,
    top: ycibo * dim,
    left: xcibo * dim
  });
  $("#score").text(score + " score");
  hgp = 0
}
var allowedTime = 200;
var startX = 0;
var startY = 0;

document.addEventListener('touchstart', function(e){
    var touch = e.changedTouches[0]
    startX = touch.pageX
    startY = touch.pageY
    startTime = new Date().getTime()
    e.preventDefault()
}, false)

document.addEventListener('touchmove', function(e){
    e.preventDefault()
}, false)

document.addEventListener('touchend', function(e){
    var touch = e.changedTouches[0]
    distX = touch.pageX - startX
    distY = touch.pageY - startY

    if (Math.abs(distX) > Math.abs(distY)) {
      if (distX > 0 && vx === 0) {
        vx = grid;
        vy = 0;
      }
      else if (distX < 0 && vx === 0) {
        vx = -grid;
        vy = 0;
      }
    } else {
      if (distY > 0 && snake.dy === 0) {
        vy = grid;
        vx = 0;
      }
      else if (distY < 0 && vy === 0) {
        vy = -grid;
        vx = 0;
      }
    }
    e.preventDefault();

}, false)
document.addEventListener("keydown", keyDownTextField, false);
function keyDownTextField(e) {
  var keyCode = e.keyCode;
  //left
  if (keyCode == 37 && vx != 1 && hgp == 0) {
    vx = -1;
    vy = 0;
    hgp = 1
  }
  //up
  if (keyCode == 38 && vy != 1 && hgp == 0) {
    vx = 0;
    vy = -1;
    hgp = 1
  }
  //right
  if (keyCode == 39 && vx != -1 && hgp == 0) {
    vx = 1;
    vy = 0;
    hgp = 1
  }
  //down
  if (keyCode == 40 && vy != -1 && hgp == 0) {
    vx = 0;
    vy = 1;
    hgp = 1
  }
  if (keyCode == 17) {
    cvel = 1
  }
}

function step() {
  if (!pausa) {
    if (lose === 0) {
      passo();
      mangia();
    }
    disegna();
  }
  vel = 150 - 100*cvel
  cvel = 0
  setTimeout(step, vel);
}

setTimeout(step, vel);

</script>
</body>
</html>
